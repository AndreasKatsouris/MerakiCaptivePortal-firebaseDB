<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard v2 - Laki Sparks</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.ico">
    
    <!-- Dashboard v2 Styles (Tailwind + shadcn/ui) -->
    <link rel="stylesheet" href="https://cdn.tailwindcss.com">
    <style>
        /* shadcn/ui CSS Variables */
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 221.2 83.2% 53.3%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96%;
            --secondary-foreground: 222.2 84% 4.9%;
            --muted: 210 40% 96%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96%;
            --accent-foreground: 222.2 84% 4.9%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 221.2 83.2% 53.3%;
            --radius: 0.5rem;
        }
        
        /* Apply CSS variables to Tailwind classes */
        .bg-background { background: hsl(var(--background)); }
        .text-foreground { color: hsl(var(--foreground)); }
        .bg-card { background: hsl(var(--card)); }
        .text-card-foreground { color: hsl(var(--card-foreground)); }
        .bg-primary { background: hsl(var(--primary)); }
        .text-primary { color: hsl(var(--primary)); }
        .text-primary-foreground { color: hsl(var(--primary-foreground)); }
        .bg-secondary { background: hsl(var(--secondary)); }
        .text-secondary-foreground { color: hsl(var(--secondary-foreground)); }
        .text-muted-foreground { color: hsl(var(--muted-foreground)); }
        .bg-accent { background: hsl(var(--accent)); }
        .border-border { border-color: hsl(var(--border)); }
        .border-input { border-color: hsl(var(--input)); }
        .ring-ring { --tw-ring-color: hsl(var(--ring)); }
        .bg-popover { background: hsl(var(--popover)); }
    </style>
    
    <!-- Font Awesome for icons (maintain compatibility) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="js/user-dashboard-v2.js?v=2.0.0-cdn" as="script">
    <link rel="preload" href="js/config/firebase-config.js" as="script">
    
    <style>
        /* Critical CSS for initial load */
        .dashboard-v2-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            flex-direction: column;
            gap: 1rem;
        }
        
        .dashboard-v2-loading-spinner {
            width: 2rem;
            height: 2rem;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Hide content until Vue app is mounted */
        [v-cloak] {
            display: none;
        }
        
        /* Dashboard specific styles */
        .dashboard-v2-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .dashboard-v2-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dashboard-v2-main {
            padding-top: 5rem;
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
        }
        
        .dashboard-v2-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .dashboard-v2-gradient-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        
        .dashboard-v2-stat-card {
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.2s ease-in-out;
        }
        
        .dashboard-v2-stat-card:hover {
            transform: translateY(-2px);
        }
        
        .dashboard-v2-stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: hsl(var(--primary));
            margin-bottom: 0.5rem;
        }
        
        .dashboard-v2-stat-label {
            font-size: 0.875rem;
            color: hsl(var(--muted-foreground));
            font-weight: 500;
        }
        
        .dashboard-v2-action-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            backdrop-filter: blur(10px);
        }
        
        .dashboard-v2-action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .dashboard-v2-action-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .dashboard-v2-action-card.locked:hover {
            transform: none;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="dashboard-v2-container">
    <!-- Loading State -->
    <div id="dashboard-loading" class="dashboard-v2-loading">
        <div class="dashboard-v2-loading-spinner"></div>
        <p class="text-sm text-muted-foreground">Loading Dashboard v2...</p>
    </div>

    <!-- Vue App Container -->
    <div id="dashboard-v2-app" v-cloak>
        <!-- Navigation Header -->
        <nav class="dashboard-v2-nav fixed top-0 left-0 right-0 z-50">
            <div class="container mx-auto px-4">
                <div class="flex items-center justify-between h-16">
                    <!-- Brand -->
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-bolt text-primary text-xl"></i>
                        <span class="text-xl font-bold text-foreground">Laki Sparks</span>
                        <span class="px-2 py-1 text-xs font-medium bg-primary/10 text-primary rounded-full">v2</span>
                    </div>

                    <!-- Desktop Navigation -->
                    <div class="hidden md:flex items-center space-x-6">
                        <a href="#dashboard" class="text-sm font-medium text-foreground hover:text-primary transition-colors">Dashboard</a>
                        <a href="user-subscription.html" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors">Subscription</a>
                        <a href="#locations" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors">Locations</a>
                        <a href="#analytics" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors">Analytics</a>
                        <a href="#campaigns" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors">Campaigns</a>
                    </div>

                    <!-- User Menu -->
                    <div class="flex items-center space-x-4">
                        <!-- Version Switcher (Development Only) -->
                        <div class="hidden lg:flex items-center space-x-2" id="version-switcher" v-if="showVersionSwitcher">
                            <span class="text-xs text-muted-foreground">Version:</span>
                            <select class="text-xs border rounded px-2 py-1" @change="switchVersion($event.target.value)">
                                <option value="v1">v1 (Bootstrap)</option>
                                <option value="v2" selected>v2 (shadcn-vue)</option>
                            </select>
                        </div>

                        <!-- User Dropdown -->
                        <div class="relative" id="user-dropdown">
                            <button class="flex items-center space-x-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 rounded-md px-3 py-2 hover:bg-accent transition-colors" @click="toggleUserMenu">
                                <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">
                                    <i class="fas fa-user text-primary text-sm"></i>
                                </div>
                                <span class="font-medium" v-text="userDisplayName">User</span>
                                <i class="fas fa-chevron-down text-xs transition-transform" :class="{ 'rotate-180': userMenuOpen }"></i>
                            </button>
                            
                            <!-- Dropdown Menu -->
                            <div v-show="userMenuOpen" class="absolute right-0 mt-2 w-48 bg-popover border border-border rounded-md shadow-lg py-1 z-50">
                                <a href="#profile" class="flex items-center px-4 py-2 text-sm text-foreground hover:bg-accent transition-colors">
                                    <i class="fas fa-user w-4 h-4 mr-3"></i>
                                    Profile
                                </a>
                                <a href="#settings" class="flex items-center px-4 py-2 text-sm text-foreground hover:bg-accent transition-colors">
                                    <i class="fas fa-cog w-4 h-4 mr-3"></i>
                                    Settings
                                </a>
                                <div class="border-t border-border my-1"></div>
                                <button @click="logout" class="flex items-center w-full text-left px-4 py-2 text-sm text-foreground hover:bg-accent transition-colors">
                                    <i class="fas fa-sign-out-alt w-4 h-4 mr-3"></i>
                                    Logout
                                </button>
                            </div>
                        </div>

                        <!-- Mobile Menu Button -->
                        <button class="md:hidden p-2 rounded-md hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring" @click="toggleMobileMenu">
                            <i class="fas fa-bars text-foreground"></i>
                        </button>
                    </div>
                </div>

                <!-- Mobile Navigation -->
                <div v-show="mobileMenuOpen" class="md:hidden border-t border-border py-4">
                    <div class="flex flex-col space-y-3">
                        <a href="#dashboard" class="text-sm font-medium text-foreground hover:text-primary transition-colors">Dashboard</a>
                        <a href="user-subscription.html" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors">Subscription</a>
                        <a href="#locations" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors">Locations</a>
                        <a href="#analytics" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors">Analytics</a>
                        <a href="#campaigns" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors">Campaigns</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="dashboard-v2-main">
            <div class="container mx-auto">
                <!-- Welcome Section -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-foreground mb-2">
                        Welcome back, <span v-text="userName">User</span>!
                    </h1>
                    <p class="text-muted-foreground">Here's what's happening with your business today.</p>
                </div>

                <!-- Subscription Info Card -->
                <div class="dashboard-v2-card dashboard-v2-gradient-card p-6 mb-8" id="subscription-info">
                    <h2 class="text-xl font-semibold mb-4">Your Subscription</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-center">
                        <div>
                            <p class="text-sm opacity-90 mb-1">Current Plan</p>
                            <p class="text-lg font-semibold" v-text="subscription.plan">Loading...</p>
                        </div>
                        <div>
                            <p class="text-sm opacity-90 mb-1">Status</p>
                            <p class="text-lg font-semibold" v-text="subscription.status">Loading...</p>
                        </div>
                        <div>
                            <p class="text-sm opacity-90 mb-1">Locations</p>
                            <p class="text-lg font-semibold" v-text="subscription.locationCount">0 / 0</p>
                        </div>
                        <div class="flex justify-end">
                            <Button variant="secondary" as="a" href="user-subscription.html" class="bg-white/20 hover:bg-white/30 text-white">
                                Manage Subscription
                            </Button>
                        </div>
                    </div>
                    
                    <!-- Feature Badges -->
                    <div class="mt-4 flex flex-wrap gap-2" id="feature-badges">
                        <Badge v-for="feature in subscription.features" :key="feature.name" 
                               :variant="feature.enabled ? 'default' : 'secondary'"
                               class="bg-white/20 text-white"
                               :class="{ 'opacity-50 line-through': !feature.enabled }">
                            {{ feature.name }}
                        </Badge>
                    </div>
                </div>

                <!-- Statistics Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="dashboard-v2-card dashboard-v2-stat-card">
                        <div class="dashboard-v2-stat-number" v-text="stats.totalGuests">0</div>
                        <div class="dashboard-v2-stat-label">Total Guests</div>
                    </div>
                    <div class="dashboard-v2-card dashboard-v2-stat-card">
                        <div class="dashboard-v2-stat-number" v-text="stats.activeCampaigns">0</div>
                        <div class="dashboard-v2-stat-label">Active Campaigns</div>
                    </div>
                    <div class="dashboard-v2-card dashboard-v2-stat-card">
                        <div class="dashboard-v2-stat-number" v-text="stats.totalRewards">0</div>
                        <div class="dashboard-v2-stat-label">Rewards Issued</div>
                    </div>
                    <div class="dashboard-v2-card dashboard-v2-stat-card">
                        <div class="dashboard-v2-stat-number" v-text="stats.engagementRate">0%</div>
                        <div class="dashboard-v2-stat-label">Engagement Rate</div>
                    </div>
                </div>

                <!-- Quick Actions Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                    <div v-for="action in quickActions" :key="action.id"
                         class="dashboard-v2-action-card relative"
                         :class="{ 'locked': !action.enabled }"
                         @click="handleActionClick(action)">
                        <div class="flex flex-col items-center text-center space-y-3">
                            <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
                                <i :class="action.icon" class="text-primary text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-foreground mb-1" v-text="action.title"></h3>
                                <p class="text-sm text-muted-foreground" v-text="action.description"></p>
                            </div>
                        </div>
                        
                        <!-- Lock Icon for Disabled Features -->
                        <div v-if="!action.enabled" class="absolute top-2 right-2">
                            <i class="fas fa-lock text-muted-foreground text-sm"></i>
                        </div>
                    </div>
                </div>

                <!-- Locations Section -->
                <div class="dashboard-v2-card p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-foreground">Your Locations</h2>
                        <Button @click="showAddLocationModal = true">
                            <i class="fas fa-plus w-4 h-4 mr-2"></i>
                            Add Location
                        </Button>
                    </div>
                    
                    <!-- Locations List -->
                    <div id="locations-list" class="space-y-4">
                        <div v-if="locations.length === 0" class="text-center py-8 text-muted-foreground">
                            <i class="fas fa-map-marker-alt text-4xl mb-4"></i>
                            <p>No locations added yet. Click "Add Location" to get started.</p>
                        </div>
                        
                        <div v-for="location in locations" :key="location.id" 
                             class="border border-border rounded-lg p-4 hover:border-ring/50 transition-colors">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-semibold text-foreground" v-text="location.name"></h3>
                                    <p class="text-sm text-muted-foreground" v-text="location.address"></p>
                                    <p class="text-sm text-muted-foreground" v-text="location.phone"></p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary">
                                        {{ location.type }}
                                    </span>
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                                          :class="location.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'">
                                        {{ location.status }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Add Location Modal (shadcn-vue Dialog) -->
        <Dialog v-model:open="showAddLocationModal">
            <div class="flex items-center justify-between p-6 border-b border-border">
                <h3 class="text-lg font-semibold">Add New Location</h3>
                <Button variant="ghost" size="icon" @click="showAddLocationModal = false">
                    <i class="fas fa-times"></i>
                </Button>
            </div>
            
            <form @submit.prevent="saveLocation" class="p-6 space-y-4">
                <div>
                    <Label>Location Name</Label>
                    <Input v-model="newLocation.name" type="text" required placeholder="Enter location name" />
                </div>
                
                <div>
                    <Label>Address</Label>
                    <Input v-model="newLocation.address" type="text" required placeholder="Enter address" />
                </div>
                
                <div>
                    <Label>Phone Number</Label>
                    <Input v-model="newLocation.phone" type="tel" required placeholder="Enter phone number" />
                </div>
                
                <div>
                    <Label>Location Type</Label>
                    <select v-model="newLocation.type" required
                            class="w-full px-3 py-2 border border-input rounded-md focus:ring-2 focus:ring-ring focus:border-transparent">
                        <option value="">Select Type</option>
                        <option value="restaurant">Restaurant</option>
                        <option value="cafe">Cafe</option>
                        <option value="bar">Bar</option>
                        <option value="hotel">Hotel</option>
                        <option value="retail">Retail Store</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div>
                    <Label>Timezone</Label>
                    <select v-model="newLocation.timezone" required
                            class="w-full px-3 py-2 border border-input rounded-md focus:ring-2 focus:ring-ring focus:border-transparent">
                        <option value="UTC">UTC</option>
                        <option value="America/New_York">Eastern Time</option>
                        <option value="America/Chicago">Central Time</option>
                        <option value="America/Denver">Mountain Time</option>
                        <option value="America/Los_Angeles">Pacific Time</option>
                        <option value="Europe/London">London</option>
                        <option value="Europe/Paris">Paris</option>
                        <option value="Asia/Tokyo">Tokyo</option>
                    </select>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <Button variant="ghost" @click="showAddLocationModal = false" type="button">
                        Cancel
                    </Button>
                    <Button type="submit" :disabled="saving">
                        <span v-if="saving" class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2"></span>
                        {{ saving ? 'Saving...' : 'Save Location' }}
                    </Button>
                </div>
            </form>
        </Dialog>
    </div>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Scripts -->
    <script type="module" src="js/user-dashboard-v2.js?v=2.0.0-cdn"></script>
</body>
</html>