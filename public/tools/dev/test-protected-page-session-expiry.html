<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protected Page - Session Expiry Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3>Protected Page - Session Expiry Test</h3>
            </div>
            <div class="card-body">
                <div id="authStatus" class="alert alert-info">
                    Loading authentication status...
                </div>

                <div id="sessionInfo"></div>

                <button id="expireBtn" class="btn btn-danger mt-3" style="display: none;">
                    Manually Expire Session (Test)
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { auth, onAuthStateChanged } from '../../js/config/firebase-config.js';

        // Simulate this page being in the protected pages list
        const isProtectedPage = true;

        onAuthStateChanged(auth, (user) => {
            const statusEl = document.getElementById('authStatus');
            const infoEl = document.getElementById('sessionInfo');
            const expireBtn = document.getElementById('expireBtn');

            if (!user && isProtectedPage) {
                // No user on protected page - redirect to login
                console.log('No user on protected page, redirecting...');
                sessionStorage.setItem('sessionExpired', 'true');
                sessionStorage.setItem('sessionExpiredMessage', 'Session expired, please log in');
                window.location.href = '/user-login.html';
                return;
            }

            if (user) {
                statusEl.className = 'alert alert-success';
                statusEl.innerHTML = `<strong>âœ… Authenticated:</strong> ${user.email}`;

                infoEl.innerHTML = `
                    <div class="mt-3">
                        <h5>Session Information:</h5>
                        <p><strong>UID:</strong> ${user.uid}</p>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p>This is a protected page. If you click the button below, your session will expire and you'll be redirected to the login page.</p>
                    </div>
                `;

                expireBtn.style.display = 'block';
                expireBtn.addEventListener('click', async () => {
                    console.log('Expiring session...');
                    await auth.signOut();
                    // Auth state listener will trigger redirect
                });
            }
        });
    </script>
</body>
</html>
