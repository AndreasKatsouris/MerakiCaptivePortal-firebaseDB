# Regression Fix: Feature #24 - Phone Number Preservation

## Issue Summary
Feature #24 test is failing due to Firebase Database emulator not running, causing PERMISSION_DENIED errors.

## Error Details
- **Test Page:** http://localhost:5000/test-phone-preservation.html
- **Error:** `PERMISSION_DENIED: Permission denied`
- **Console Error:** `Error creating guest: Error`
- **Root Cause:** Firebase Hosting is running on port 5000, but Database emulator (port 9000) is not running

## Current State
- ✅ Firebase Hosting: Running on port 5000
- ❌ Firebase Database Emulator: Not running (port 9000)
- ❌ Firebase Functions Emulator: Not running (port 5001)

## Fix Required

### Step 1: Stop Current Hosting Server
```bash
# If Firebase serve is running, stop it (Ctrl+C)
```

### Step 2: Start Full Emulator Suite
```bash
npm run emulators
# OR
firebase emulators:start --import=./firebase-export --export-on-exit
```

This will start:
- Firebase Hosting on port 5000
- Firebase Database emulator on port 9000
- Firebase Functions emulator on port 5001
- Firebase Firestore emulator on port 8080
- Firebase Storage emulator on port 9199

### Step 3: Re-test Feature 24
1. Navigate to http://localhost:5000/test-phone-preservation.html
2. Click "Step 1: Create Guest with Phone +27812345678"
3. Verify success message (no PERMISSION_DENIED error)
4. Click through all test steps to verify phone preservation

## Expected Results After Fix
- ✅ Step 1: Guest created successfully
- ✅ Step 2: Guest data retrieved
- ✅ Step 3: User registered with same phone
- ✅ Step 4: Guest data still exists (not overwritten)
- ✅ Step 5: Auth user linked to phone number

## Verification Command
After starting emulators, verify all ports are responding:
```bash
curl http://localhost:5000  # Hosting
curl http://localhost:9000/.json  # Database
curl http://localhost:5001  # Functions
```

## Prevention
To prevent this regression in the future:
1. Always run `npm run emulators` for local development
2. Add emulator check to CI/CD pipeline
3. Document emulator requirement in test files
